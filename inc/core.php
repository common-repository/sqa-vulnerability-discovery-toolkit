<?php
/* Reterives the security.txt file. */
function sqa_nvdt_filter($rv, $public)
{
    $sqa_nvdt_content = get_option('sqa_nvdt_content');
    if ($sqa_nvdt_content) {
        $rv = esc_attr(strip_tags($sqa_nvdt_content));
    }

    return $rv;
}

/* Deactivation hook. Deletes the security.txt content */
function sqa_nvdt_deactivation()
{
    delete_option('sqa_nvdt_content');
    sqa_nvdt_delete_files(SQA_NVDT_PLUGIN_DIR . SECURITY_TXT_DIR);
}

/* Recursively delets files and then the folder */
function sqa_nvdt_delete_files($target) 
{
    if(is_dir($target)){
        $files = glob( $target . '*', GLOB_MARK );
        foreach( $files as $file ){
            delete_files( $file );      
        }
        rmdir( $target );
    } elseif(is_file($target)) {
        unlink( $target );  
    }
}

/* Activation hook.  Adds the option */
function sqa_nvdt_activation()
{
    add_option('sqa_nvdt_content', false);
}